
###############################################################################
#  PERSISTENT DATA
#  --------------‚Äë
#  * mini‚Äëca-data holds the root key/cert + every certificate you issue.
###############################################################################

###############################################################################
#  MINI‚ÄëCA  (single, all‚Äëin‚Äëone container)
#  ---------------------------------------
#  * `init` sub‚Äëcommand ‚Äî one‚Äëshot to create the root CA (run via `docker compose run`).
#  * `issue` sub‚Äëcommand ‚Äî ad‚Äëhoc certificate issuance.
#  * `watch` sub‚Äëcommand ‚Äî batch‚Äëissuer that tails a domain list and auto‚Äërenews.
#
#  Change **nothing** below unless you know what you‚Äôre doing üòâ
###############################################################################
services:
  mini-ca:
    image: ghcr.io/<your‚Äëgithub‚Äëuser>/mini-ca:latest     # ‚Üê push / pull from your own registry
    container_name: mini-ca
    user: 1001:1001               # runs as the non‚Äëroot ‚Äúmyca‚Äù user inside the image
    volumes:
      - mini-ca-data:/data        # **the only volume you normally need**
    #---------------------------------------------------------------------
    # CMD / ENTRYPOINT notes
    #---------------------------------------------------------------------
    # ¬∑ No command  -> defaults to `sleep infinity` (idle CA, handy for `exec`)
    # ¬∑ init        -> creates rootCA if absent
    # ¬∑ issue ...   -> one‚Äëoff certificate
    # ¬∑ watch ...   -> daemon that reads DOMAINS file & renews
    # command: ["sleep","infinity"]
    # command: ["init"]
    # command: ["issue","myhost","--san","*.myhost.local"]
    # command: ["watch","--file","/data/DOMAINS","--refresh","12h"]
    #---------------------------------------------------------------------
    environment:
      # =========  REQUIRED  =============================================
      MYCA_ROOT: /data/rootCA           # where the root CA key/cert live
      # =========  COMMON OPTIONALS  =====================================
      # MYCA_CERTS: /data/certificates  # directory for issued certs
      # DAYS: 825                       # validity period for new certs
      # FORCE: "true"                   # overwrite existing root CA on init
      # UID: "1001"                     # numeric UID to chown new files
      # GID: "1001"                     # numeric GID for group ownership
      # =========  BATCH / WATCH MODE  ===================================
      # WATCH_FILE: /data/DOMAINS       # file containing FQDNs¬†(one per line)
      # WATCH: "true"                   # enable domain‚Äëlist watcher
      # REFRESH: 12h                    # how often to re‚Äëcheck / renew certs




volumes:
  mini-ca-data:   # external: true   # ‚Üê uncomment to share across projects
    restart: unless-stopped






